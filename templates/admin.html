{% extends "base.html" %}
{% block title %}Admin Panel{% endblock %}
{% block content %}
<h2>Admin Panel: Manage Data</h2>
<nav aria-label="Breadcrumb"><a href="{{ url_for('dashboard') }}">Dashboard</a> > Admin Panel</nav>
{% if message %}<p style="color: green; text-align: center;" role="alert">{{ message }}</p>{% endif %}

<h3>Edit Mineral</h3>
<form method="POST" style="margin-bottom: 20px;">
    <input type="hidden" name="action" value="edit_mineral">
    <label for="mineral_name">Select Mineral:</label>
    <select name="mineral_name" id="mineral_name" required>
        {% for mineral in minerals.keys() %}
        <option value="{{ mineral }}">{{ mineral }}</option>
        {% endfor %}
    </select><br>
    <label for="description">Description:</label><br>
    <textarea name="description" id="description" rows="2" cols="40" required></textarea><br>
    <label for="market_price">Market Price (USD/tonne):</label><br>
    <input type="number" name="market_price" id="market_price" required><br>
    <button type="submit">Update Mineral</button>
</form>
<form method="POST" style="margin-bottom: 20px;">
    <input type="hidden" name="action" value="delete_mineral">
    <label for="mineral_name">Delete Mineral:</label>
    <select name="mineral_name" required>
        {% for mineral in minerals.keys() %}
        <option value="{{ mineral }}">{{ mineral }}</option>
        {% endfor %}
    </select>
    <button type="submit" style="background: #d32f2f; color: white;">Delete</button>
</form>

<h3>Add Country</h3>
<form method="POST" style="margin-bottom: 20px;">
    <input type="hidden" name="action" value="add_country">
    <label for="country_name">Country Name:</label>
    <input type="text" name="country_name" required><br>
    <label for="gdp">GDP (Billion USD):</label>
    <input type="number" name="gdp" required><br>
    <label for="mining_revenue">Mining Revenue (Billion USD):</label>
    <input type="number" name="mining_revenue" required><br>
    <label for="key_projects">Key Projects:</label>
    <input type="text" name="key_projects" required><br>
    <button type="submit">Add Country</button>
</form>
<form method="POST" style="margin-bottom: 20px;">
    <input type="hidden" name="action" value="delete_country">
    <label for="country_name">Delete Country:</label>
    <select name="country_name" required>
        {% for country in countries.keys() %}
        <option value="{{ country }}">{{ country }}</option>
        {% endfor %}
    </select>
    <button type="submit" style="background: #d32f2f; color: white;">Delete</button>
</form>

<h3>Add Site</h3>
<form method="POST" style="margin-bottom: 20px;">
    <input type="hidden" name="action" value="add_site">
    <label for="site_name">Site Name:</label>
    <input type="text" name="site_name" required><br>
    <label for="site_country">Country:</label>
    <select name="site_country" required>
        {% for country in countries.keys() %}
        <option value="{{ country }}">{{ country }}</option>
        {% endfor %}
    </select><br>
    <label for="site_mineral">Mineral:</label>
    <select name="site_mineral" required>
        {% for mineral in minerals.keys() %}
        <option value="{{ mineral }}">{{ mineral }}</option>
        {% endfor %}
    </select><br>
    <label for="latitude">Latitude:</label>
    <input type="number" step="any" name="latitude" required><br>
    <label for="longitude">Longitude:</label>
    <input type="number" step="any" name="longitude" required><br>
    <label for="production">Production (tonnes):</label>
    <input type="number" name="production" required><br>
    <button type="submit">Add Site</button>
</form>
<form method="POST" style="margin-bottom: 20px;">
    <input type="hidden" name="action" value="delete_site">
    <label for="site_name">Delete Site:</label>
    <select name="site_name" required>
        {% for site in sites %}
        <option value="{{ site.SiteName }}">{{ site.SiteName }}</option>
        {% endfor %}
    </select>
    <button type="submit" style="background: #d32f2f; color: white;">Delete</button>
</form>

<h3>All Minerals</h3>
<ul>
{% for mineral, info in minerals.items() %}
    <li><strong>{{ mineral }}</strong>: {{ info.Description }} | ${{ info.MarketPriceUSD_per_tonne }}</li>
{% endfor %}
</ul>

<h3>All Countries</h3>
<ul>
{% for country, info in countries.items() %}
    <li><strong>{{ country }}</strong>: GDP ${{ info.GDP_BillionUSD }}B | Mining Revenue ${{ info.MiningRevenue_BillionUSD }}B | Projects: {{ info.KeyProjects }}</li>
{% endfor %}
</ul>

<h3>All Sites</h3>
<ul>
{% for site in sites %}
    <li><strong>{{ site.SiteName }}</strong>: {{ site.MineralName }} in {{ site.CountryName }} ({{ site.Production_tonnes }} tonnes) [{{ site.Latitude }}, {{ site.Longitude }}]</li>
{% endfor %}
</ul>

<p style="color: #888;">Note: Changes are in-memory only and will be lost on restart. To persist, update the CSV files directly.</p>
{% endblock %}
